name: ğŸš€ CI/CD - Pharma Recipes API

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    env:
      DOTNET_VERSION: '8.0.x'
      PROJECT_PATH: './Pharma.Recipes.API/Pharma.Recipes.API.csproj'

    steps:
    - name: ğŸ§¾ Checkout Repo
      uses: actions/checkout@v3

    - name: ğŸ”§ Setup .NET ${{ env.DOTNET_VERSION }}
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ğŸ“¦ Restore Dependencies
      run: dotnet restore ${{ env.PROJECT_PATH }}

    - name: ğŸ›  Build Project
      run: dotnet build ${{ env.PROJECT_PATH }} --configuration Release --no-restore

    - name: âœ… Run Tests (optional)
      run: dotnet test --no-build --verbosity normal
      continue-on-error: true

    - name: ğŸ³ Build Docker Image
      run: docker build -t pharma-recipes-api .

    # OPTIONAL: Push to Docker Hub (replace with your repo)
    # - name: ğŸ” Login to DockerHub
    #   uses: docker/login-action@v2
    #   with:
    #     username: ${{ secrets.DOCKER_USERNAME }}
    #     password: ${{ secrets.DOCKER_PASSWORD }}

    # - name: ğŸš€ Push Docker Image
    #   run: |
    #     docker tag pharma-recipes-api yourdockerhub/pharma-recipes-api:latest
    #     docker push yourdockerhub/pharma-recipes-api:latest
